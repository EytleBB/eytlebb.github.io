<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC Stronghold Finder</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --mc-bg: #202020;
            --mc-panel: #313131;
            --mc-btn: #7E7E7E;
            --mc-green: #55FF55;
            --mc-red: #FF5555;
            --mc-white: #FFFFFF;
        }
        body {
            background-color: #121212;
            color: var(--mc-white);
            font-family: 'VT323', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: var(--mc-panel);
            border: 4px solid #000;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 0 4px #555;
        }
        h1 { color: var(--mc-green); text-align: center; margin-top: 0; text-shadow: 2px 2px #000; }
        .row { display: flex; gap: 10px; margin-bottom: 5px; align-items: center; }
        .row label { width: 40px; text-align: right; font-size: 1.2rem; }
        input {
            flex: 1;
            background: #000;
            border: 2px solid #555;
            color: var(--mc-white);
            padding: 5px;
            font-family: inherit;
            font-size: 1.2rem;
        }
        .section-title { color: #FFFF55; border-bottom: 2px solid #555; margin: 15px 0 10px 0; }
        
        button {
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            font-family: inherit;
            font-size: 1.5rem;
            background: var(--mc-btn);
            color: #fff;
            border: 4px solid #000;
            cursor: pointer;
            text-shadow: 2px 2px #000;
            box-shadow: inset 4px 4px 0 rgba(255,255,255,0.2), inset -4px -4px 0 rgba(0,0,0,0.2);
        }
        button:active { transform: translateY(2px); }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border: 2px dashed #777;
            font-size: 1.3rem;
            white-space: pre-line;
        }
        
        /* å¯è§†åŒ–ç”»å¸ƒæ ·å¼ */
        #visualizer {
            margin-top: 20px;
            background: #000;
            border: 2px solid var(--mc-green);
            display: none; /* é»˜è®¤éšè—ï¼Œè®¡ç®—æˆåŠŸåæ˜¾ç¤º */
        }
    </style>
</head>
<body>

<div class="container">
    <h1>STRONGHOLD FINDER</h1>

    <div class="section-title">Point 1 (ç¬¬ä¸€æ¬¡æŠ•æ·)</div>
    <div class="row"><label>X:</label><input type="number" id="x1"></div>
    <div class="row"><label>Z:</label><input type="number" id="z1"></div>
    <div class="row"><label>Yaw:</label><input type="number" id="yaw1"></div>

    <div class="section-title">Point 2 (ç¬¬äºŒæ¬¡æŠ•æ·)</div>
    <div class="row"><label>X:</label><input type="number" id="x2"></div>
    <div class="row"><label>Z:</label><input type="number" id="z2"></div>
    <div class="row"><label>Yaw:</label><input type="number" id="yaw2"></div>

    <button onclick="calculate()">[ è®¡ ç®— å æ ‡ ]</button>
    
    <div id="result"></div>
    <canvas id="visualizer" width="460" height="300"></canvas>
</div>

<script>
    function calculate() {
        // 1. è·å–è¾“å…¥
        const x1 = parseFloat(document.getElementById('x1').value);
        const z1 = parseFloat(document.getElementById('z1').value);
        const yaw1 = parseFloat(document.getElementById('yaw1').value);
        const x2 = parseFloat(document.getElementById('x2').value);
        const z2 = parseFloat(document.getElementById('z2').value);
        const yaw2 = parseFloat(document.getElementById('yaw2').value);

        const resBox = document.getElementById('result');
        const canvas = document.getElementById('visualizer');

        if ([x1, z1, yaw1, x2, z2, yaw2].some(isNaN)) {
            resBox.innerHTML = "<span style='color:var(--mc-red)'>âŒ è¯·å¡«å†™æ‰€æœ‰æ•°å€¼ï¼</span>";
            return;
        }

        // 2. æ ¸å¿ƒæ•°å­¦é€»è¾‘ (ä¿®æ­£ç‰ˆ)
        // MC Yaw: 0=South(+Z), 90=West(-X), 180=North(-Z), -90=East(+X)
        // è½¬æ¢ä¸ºå¼§åº¦
        const r1 = yaw1 * Math.PI / 180;
        const r2 = yaw2 * Math.PI / 180;

        // MC æ–¹å‘å‘é‡ (å•ä½å‘é‡)
        // xå¢é‡ = -sin(yaw), zå¢é‡ = cos(yaw)
        const v1x = -Math.sin(r1), v1z = Math.cos(r1);
        const v2x = -Math.sin(r2), v2z = Math.cos(r2);

        // ä½¿ç”¨äºŒç»´å‘é‡å‰ä¹˜æ±‚äº¤ç‚¹ (P1 + t*V1 = P2 + u*V2)
        // t = ((P2 - P1) x V2) / (V1 x V2)
        // äºŒç»´å‰ä¹˜ A x B = Ax*Bz - Az*Bx
        
        const dx = x2 - x1;
        const dz = z2 - z1;

        // åˆ†æ¯: V1 x V2
        const det = v1x * v2z - v1z * v2x;

        // æ£€æŸ¥å¹³è¡Œ
        if (Math.abs(det) < 0.0001) {
            resBox.innerHTML = "<span style='color:var(--mc-red)'>âš ï¸ è½¨è¿¹å¹³è¡Œæˆ–é‡åˆï¼Œæ— æ³•è®¡ç®—äº¤ç‚¹ã€‚<br>è¯·ç§»åŠ¨è‡³å°‘100æ ¼å¹¶ç¡®ä¿è§’åº¦å˜åŒ–æ˜æ˜¾ã€‚</span>";
            canvas.style.display = 'none';
            return;
        }

        // åˆ†å­: (P2 - P1) x V2 = dx*v2z - dz*v2x
        const t = (dx * v2z - dz * v2x) / det;

        // 3. è®¡ç®—ç»“æœ
        // ç›®æ ‡åæ ‡
        const targetX = x1 + t * v1x;
        const targetZ = z1 + t * v1z;
        
        // è·ç¦» (ç›¸å¯¹äºç©å®¶å½“å‰ä½ç½® P2)
        const dist = Math.sqrt(Math.pow(targetX - x2, 2) + Math.pow(targetZ - z2, 2));

        // 4. æ˜¾ç¤ºç»“æœ
        resBox.innerHTML = `
            <span style="color:var(--mc-green)">âœ… ä¸»ä¸–ç•Œç›®æ ‡ (Overworld)</span>
            X: <b>${Math.round(targetX)}</b>
            Z: <b>${Math.round(targetZ)}</b>
            è·ç¦»: ${Math.round(dist)} æ ¼
            
            <hr style="border:1px dashed #555">
            <span style="color:#FF5555">ğŸ”¥ ä¸‹ç•Œä¼ é€é—¨ (Nether)</span>
            X: <b>${Math.round(targetX / 8)}</b>
            Z: <b>${Math.round(targetZ / 8)}</b>
        `;

        // 5. è°ƒç”¨å¯è§†åŒ–ç»˜å›¾
        drawVisuals(x1, z1, x2, z2, targetX, targetZ);
    }

    function drawVisuals(x1, z1, x2, z2, tx, tz) {
        const canvas = document.getElementById('visualizer');
        const ctx = canvas.getContext('2d');
        canvas.style.display = 'block';

        // æ¸…ç©ºç”»å¸ƒ
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // è‡ªåŠ¨ç¼©æ”¾é€»è¾‘ï¼šæ‰¾å‡ºåŒ…å«ä¸‰ä¸ªç‚¹(P1, P2, Target)çš„è¾¹ç•Œ
        const padding = 40;
        const minX = Math.min(x1, x2, tx);
        const maxX = Math.max(x1, x2, tx);
        const minZ = Math.min(z1, z2, tz);
        const maxZ = Math.max(z1, z2, tz);

        const rangeX = maxX - minX || 1;
        const rangeZ = maxZ - minZ || 1;
        
        // ä¿æŒæ¯”ä¾‹
        const scale = Math.min(
            (canvas.width - padding * 2) / rangeX,
            (canvas.height - padding * 2) / rangeZ
        );

        // åæ ‡æ˜ å°„å‡½æ•° (å°† MC åæ ‡æ˜ å°„åˆ° Canvas åæ ‡)
        // Canvas Yè½´å‘ä¸‹ï¼ŒMC Zè½´å‘ä¸‹(å—)ï¼Œæ‰€ä»¥æ–¹å‘ä¸€è‡´ï¼Œä¸éœ€è¦åè½¬Yè½´ï¼Œåªéœ€è¦å¹³ç§»ç¼©æ”¾
        function toCanvas(x, z) {
            return {
                x: padding + (x - minX) * scale,
                y: padding + (z - minZ) * scale
            };
        }

        const p1 = toCanvas(x1, z1);
        const p2 = toCanvas(x2, z2);
        const pt = toCanvas(tx, tz);

        // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
        ctx.strokeStyle = '#222';
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<canvas.width; i+=20) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
        for(let i=0; i<canvas.height; i+=20) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
        ctx.stroke();

        // ç»˜åˆ¶å°„çº¿ 1 (é»„è‰²)
        ctx.strokeStyle = '#FFFF55';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(pt.x, pt.y);
        ctx.stroke();

        // ç»˜åˆ¶å°„çº¿ 2 (è“è‰²)
        ctx.strokeStyle = '#55FFFF';
        ctx.beginPath();
        ctx.moveTo(p2.x, p2.y);
        ctx.lineTo(pt.x, pt.y);
        ctx.stroke();

        // ç»˜åˆ¶èµ·ç‚¹ P1
        ctx.fillStyle = '#FFFF55';
        ctx.beginPath(); ctx.arc(p1.x, p1.y, 4, 0, Math.PI*2); ctx.fill();
        ctx.fillText("P1", p1.x + 5, p1.y - 5);

        // ç»˜åˆ¶èµ·ç‚¹ P2
        ctx.fillStyle = '#55FFFF';
        ctx.beginPath(); ctx.arc(p2.x, p2.y, 4, 0, Math.PI*2); ctx.fill();
        ctx.fillText("P2", p2.x + 5, p2.y - 5);

        // ç»˜åˆ¶ç›®æ ‡ç‚¹ Target
        ctx.fillStyle = '#55FF55';
        ctx.beginPath(); ctx.arc(pt.x, pt.y, 6, 0, Math.PI*2); ctx.fill();
        ctx.font = "16px monospace";
        ctx.fillText("è¦å¡", pt.x + 10, pt.y);
    }
</script>

</body>
</html>


